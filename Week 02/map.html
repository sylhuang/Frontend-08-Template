<!DOCTYPE html>
<html>
  <head>
    <title>Shortest Path</title>
    <style>
      .row {
        display: flex;
      }
      .cell {
        width: 5px;
        height: 5px;
        line-height: 7px;
        background-color: gray;
        display: inline-block;
        border: solid 1px white
      }
    </style>
  </head>
  <body>
    <div id='container'></div>
    <div>
      <button onclick="save()">SAVE</button>
      <button onclick="load()">LOAD</button>
      <button onclick="clearAll()">CLEAR ALL</button>
    </div>

    <script>
      // initialize map
      let map = localStorage.getItem('map') ? JSON.parse(localStorage.getItem('map')) : Array(10000).fill(0);
      let mousedown = false;
      let clear = false;
      let container = document.getElementById('container');

      container.addEventListener('mousedown', (e) => {
        mousedown = true;
        clear = e.which === 3;
      })

      container.addEventListener('mouseup', () => {
        mousedown = false;
        clear = false;
      });

      container.addEventListener('contextmenu', e => e.preventDefault());

      show();

      function show() {
        container.innerHTML = null;

        for (let x = 0; x < 100; x++) {
          let row = document.createElement('div');
          row.classList.add('row');

          for (let y = 0; y < 100; y++) {
            let cell = document.createElement('div');
            
            cell.classList.add('cell');

            if (map[100 * x + y] === 1) {
              cell.style.backgroundColor = 'black';
            }

            cell.addEventListener('mousemove', () => {
              if (mousedown) {
                if (clear) {
                  cell.style.backgroundColor = 'gray';
                  map[100 * x + y] = 0;
                } else {
                  cell.style.backgroundColor = 'black';
                  map[100 * x + y] = 1;
                }
              }
            })

            row.appendChild(cell);
          }

          container.appendChild(row);
        }
      }

      function save() {
        localStorage.setItem('map', JSON.stringify(map));
      }

      function load() {
        map = localStorage.getItem('map') ? JSON.parse(localStorage.getItem('map')) : Array(10000).fill(0);
        show();
      }

      function clearAll() {
        map.fill(0);
        show();
      }

      async function findPath(start, end) {
        const table = Object.create(map);
        const [sx, sy] = start;
        const [ex, ey] = end;

        // bfs
        const queue = [];

        function insert(x, y, pre) {
          // if out of bound / blocked / visited
          if (x < 0 || x >= 100 || y < 0 || y >= 100 || table[100 * x + y]) {
            return;
          }

          queue.push([x, y]);
          table[100 * x + y] = pre;
          container.children[x].children[y].style.backgroundColor = 'lightgreen';
        }

        function take() {
          return queue.shift();
        }

        insert(sx, sy);

        while (queue.length) {
          let [cx, cy] = take();

          if (cx === ex && cy === ey) {
            const path = [];

            do {
              path.push([cx, cy]);
              container.children[cx].children[cy].style.backgroundColor = 'green';

              [cx, cy] = table[100 * cx + cy];
            } while (cx !== sx || cy !== sy)

            path.push([cx, cy]);
            container.children[cx].children[cy].style.backgroundColor = 'green';

            return path;
          }

          insert(cx + 1, cy, [cx, cy]);
          insert(cx - 1, cy, [cx, cy]);
          insert(cx, cy + 1, [cx, cy]);
          insert(cx, cy - 1, [cx, cy]);
          insert(cx + 1, cy + 1, [cx, cy]);
          insert(cx - 1, cy - 1, [cx, cy]);
          insert(cx - 1, cy + 1, [cx, cy]);
          insert(cx + 1, cy - 1, [cx, cy]);
        }
      }
    </script>
  </body>
</html>